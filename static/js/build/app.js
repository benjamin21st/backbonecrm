define("local_config",[],function(){return{devEnviron:"development",urlRoot:"http://localhost:5001"}}),require.config({baseUrl:"static/js/build/",paths:{jquery:"../vendor/jquery-2.1.3.min",underscore:"../vendor/lodash",backbone:"../vendor/backbone",bootstrapOverlay:"../vendor/bootstrapOverlay",handlebars:"../vendor/handlebars",semantic:"../vendor/semantic",text:"../vendor/text",highcharts:"../vendor/highstock.src",numberJumper:"../vendor/number_jump",templates:"templates/"},shim:{underscore:{exports:"_"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},bootstrapOverlay:{deps:["jquery"],exports:"bootstrapOverlay"},handlebars:{exports:"Handlebars"}}}),define("index",function(){}),define("common",["require","jquery","backbone"],function(e){var t=e("jquery"),n=e("backbone"),r={loadApp:function(e){t("#app-container").html(e)}};return n.Model.prototype.parseDates=function(){return this.attributes.created_at=(new Date(this.attributes.created_at)).toLocaleString(),this.attributes.updated_at=(new Date(this.attributes.updated_at)).toLocaleString(),this},n.Model.prototype.rollback=function(){return this.attributes=this.previousAttributes(),this},n.Model.prototype.applyChanges=function(){var e=this.changedAttributes();for(var t in e)this.attributes[t]=e[t];return this},n.View.prototype.close=function(){this.remove(),this.unbind(),this.onClose&&this.onClose()},n.View.prototype.hide=function(){this.$el.hide()},r}),define("text!apps/user_manager/templates/user_list_item.html",[],function(){return"<!-- User list item template -->\n<td>{{userData.fullname}}</td>\n<td>{{userData.email}}</td>\n<td>{{userData.type}}</td>\n<td>{{userData.organization}}</td>\n<td>{{userData.date_creation}}</td>\n"}),define("text!apps/user_manager/templates/users.html",[],function(){return'<h3>\n  <i class="fa fa-users"></i>\n  <span>User List</span>\n</h1>\n<table id="user-table" class="user-table sortable-table data-table table table-hover">\n  <thead>\n    <tr>\n      <th data-name="fullname" class="SortableHead sort-asc table-head">\n        <span class="header-text">Fullname</span>\n        <i class="fa fa-sort-alpha-asc"></i>\n        <i class="fa fa-sort-alpha-desc"></i>\n      </th>\n      <th data-name="email" class="SortableHead sort-asc table-head">\n        <span class="header-text">Email</span>\n        <i class="fa fa-sort-alpha-asc"></i>\n        <i class="fa fa-sort-alpha-desc"></i>\n      </th>\n      <th data-name="type" class="SortableHead sort-asc table-head">\n        <span class="header-text">Type</span>\n        <i class="fa fa-sort-alpha-asc"></i>\n        <i class="fa fa-sort-alpha-desc"></i>\n      </th>\n      <th data-name="organization" class="SortableHead sort-asc table-head">\n        <span class="header-text">Organization</span>\n        <i class="fa fa-sort-alpha-asc"></i>\n        <i class="fa fa-sort-alpha-desc"></i>\n      </th>\n      <th data-name="created_at" class="SortableHead sort-desc sorting table-head">\n        <span class="header-text">Registered Date</span>\n        <i class="fa fa-sort-numeric-asc"></i>\n        <i class="fa fa-sort-numeric-desc"></i>\n      </th>\n    </tr>\n  </thead>\n\n  <tbody class="table-data"></tbody>\n</table>\n<div class="table-attachment">\n  <button class="LoadMoreData btn btn-default">Load more</button>\n</div>'}),define("text!apps/user_manager/templates/user_details.html",[],function(){return'<!-- Tempalte for file editor for admin.  -->\n<h3>User Details</h3>\n<form name="user-details-form" class="form details-form">\n\n  <div class="message-container">\n    <p class="text-{{message_type}}">{{message_content}}</p>\n  </div>\n\n  <div class="form-group">\n    <label class="col-xs-4 col-md-8 col-sm-4">User name</label>\n    <p class="col-xs-8 col-md-4 col-sm-8">{{fullname}}</p>\n  </div>\n\n  <div class="form-group">\n    <label class="col-xs-4 col-md-8 col-sm-4">User Email</label>\n    <p class="col-xs-8 col-md-4 col-sm-8">{{email}}</p>\n  </div>\n\n  <div class="form-group">\n    <label class="col-xs-4 col-md-8 col-sm-4">User Type</label>\n    <p class="editable col-xs-8 col-md-4 col-sm-8">{{type}}</p>\n    <!-- TODO: decide whether to show a drop-down here or have a master "edit button" -->\n    <div class="col-xs-8 col-md-4 col-sm-8">\n      <select id="user-types" class="editing options">\n        <option {{userSelected}} value="user">User</option>\n        <option {{demouserSelected}} value="demo_user">Demo User</option>\n        <option {{customerSelected}} value="customer">Customer</option>\n        <option {{adminSelected}} value="admin">Admin</option>\n      </select>\n    </div>\n  </div>\n\n  <div class="form-group">\n    <label class="col-xs-4 col-md-8 col-sm-4">Organization</label>\n    <p class="editable col-xs-8 col-md-4 col-sm-8">{{organization}}</p>\n    <!-- TODO: same as above -->\n    <!-- TODO: Maybe having a list of recommended/available organizations? -->\n    <div class="col-xs-8 col-md-4 col-sm-8">\n      <input id="organization-name" class="editing form-control" value="{{organization}}"/>\n    </div>\n  </div>\n\n  <div class="form-group">\n    <div class="">\n      <div class="edit editable btn btn-default btn-sm">\n        <i class="fa fa-pencil"></i>\n        <span class="button-text">Edit</span>\n      </div>\n      <div class="close-view editable btn btn-default btn-sm">  <i class="fa fa-reply"></i>\n        <span class="button-text">Back</span>\n      </div>\n      <div class="cancel editing btn btn-default btn-sm">\n        <i class="fa fa-times"></i>\n        <span class="button-text">Cancel</span>\n      </div>\n      <div class="save editing btn btn-default btn-sm" type="submit">\n        <i class="fa fa-floppy-o"></i>\n        <span class="button-text">Save</span>\n      </div>\n      <div class="delete editing btn btn-default btn-sm">\n        <i class="fa fa-trash text-danger"></i>\n      </div>\n    </div>\n  </div>\n</form>\n'}),define("text!templates/confirmation_dialog.html",[],function(){return'<div class="confirmation-dialog pop-up-dialog">\n  <p class="message title">Please Confirm</p>\n  <div class="detailed-content">\n    <p class="details">\n      {{data.confirmationMessage}}\n    </p>\n    <p class="details">\n      <b>{{data.messageContent}}</b>\n    </p>\n    <div class="additional-content"></div>\n  </div>\n\n  <div class="button-group">\n    <span class="confirm btn btn-sm btn-primary">Confirm</span>\n    <span class="cancel btn btn-sm btn-default">Cancel</span>\n  </div>\n</div>\n'}),define("views/partials/dialog",["require","jquery","underscore","backbone","handlebars","text!templates/confirmation_dialog.html","bootstrapOverlay"],function(e){"use strict";var t=e("jquery"),n=e("underscore"),r=e("backbone"),i=e("handlebars"),s=e("text!templates/confirmation_dialog.html");e("bootstrapOverlay");var o=r.View.extend({className:"modal",events:{"click .confirm":"confirmOperation","click .cancel":"cancelOperation"},template:i.compile(s),render:function(){return this.$el.html(this.template({data:this.data})),this.$el.modal("show"),this},loadData:function(e,t,n){this.data={confirmationMessage:e,messageContent:t},this.callback=n},confirmOperation:function(){this.callback(),this.$el.modal("hide")},cancelOperation:function(){this.$el.modal("hide")}});return{confirmationDialog:new o}}),define("models/subtypes",["require","jquery","backbone"],function(e){"use strict";var t=e("jquery"),n=e("backbone"),r=n.Collection.extend({initialize:function(e){for(var t in e)this[t]=e[t];this.sortCriteria=null,this.sortOrder=1},comparator:function(e,t){var n=e.get(this.sortCriteria),r=t.get(this.sortCriteria),i;if(typeof n==typeof r&&typeof n=="string")n=n.toLowerCase(),r=r.toLowerCase();else if(typeof n==typeof r&&typeof n===undefined)n=r=-Infinity;else if(typeof n!=typeof r)return 0;return n<r?i=-1:n>r?i=1:i=0,i*this.sortOrder},sortByAttribute:function(e,t){return this.sortCriteria=e,this.sortOrder=t,this.sort(this.comparator),this}}),i=n.View.extend({events:{"click .SortableHead":"sortByAttribute","click .LoadMoreData":"loadMoreData"},initialize:function(){},sortByAttribute:function(e){var n=e.currentTarget,r=t(n).hasClass("sorting"),i=t(n).attr("data-name");return r?t(n).hasClass("sort-asc")?(t(n).removeClass("sort-asc").addClass("sort-desc"),this.collection.sortByAttribute(i,-1)):t(n).hasClass("sort-desc")&&(t(n).removeClass("sort-desc").addClass("sort-asc"),this.collection.sortByAttribute(i,1)):(t(n).addClass("sorting"),this.collection.sortByAttribute(i,1)),this.reloadTableData()},reloadTableData:function(){this.reloadView(this.collection)},reloadView:function(e){var t=e.models,n=t.length,r,i,s=[];for(var o=0;o<n;o++)r=t[o].parseDates(),i=new this.childView({model:r}),s.push(i.el);return this.$el.find(".table-data").html(s),this},loadMoreData:function(e){var t,n,r,i=this.collection.url,s=this;try{t=parseInt(i.match(/limit=\d+/)[0].match(/\d+/)[0])}catch(o){t||(t=10)}try{n=parseInt(i.match(/offset=\d+/)[0].match(/\d+/)[0]),n+=t}catch(o){n||(n=10)}try{r=i.match(/.+\?/)[0]||i}catch(o){r=i+"?"}this.collection.url=r+"offset="+n+"&limit="+t,this.newCollection=new this.baseCollection,this.newCollection.url=this.collection.url,this.newCollection.fetch({success:function(e){if(!e)return console.log("There are no more data to be retrieved.");var t=e.models,n=t.length,r,i,o=[];for(var u=0;u<n;u++)r=t[u].parseDates(),s.collection.add(r),i=new s.childView({model:r}),o.push(i.el);s.$el.find(".table-data").append(o)},error:function(e,t,n){console.log(n.message)}})}});return{SortableCollection:r,SortableTableView:i}}),define("apps/user_manager/scripts/models/user",["require","backbone"],function(e){"use strict";var t=e("backbone"),n=t.Model.extend({defaults:{fullname:"",email:"",type:"user",organization:"",created_at:"",org_name:"",em_frequency:7,em_frequency_txt:"weekly"},parse:function(e){var t=e.data?e.data:e;switch(t.em_frequency){case 1:t.em_daily="selected",t.em_frequency_txt="daily";break;case 7:t.em_weekly="selected",t.em_frequency_txt="weekly";break;case 30:t.em_monthly="selected",t.em_frequency_txt="monthly";break;case 0:t.em_never="selected",t.em_frequency_txt="never";break;default:t.em_weekly="selected",t.em_frequency_txt="weekly"}return t}});return n}),define("apps/user_manager/scripts/models/users",["require","backbone","models/subtypes","apps/user_manager/scripts/models/user"],function(e){var t=e("backbone"),n=e("models/subtypes"),r=e("apps/user_manager/scripts/models/user"),i=n.SortableCollection.extend({url:"/admin/users/all",model:r,parse:function(e){return e.data}});return i}),define("apps/user_manager/scripts/views/user_manager",["require","jquery","backbone","handlebars","local_config","text!apps/user_manager/templates/user_list_item.html","text!apps/user_manager/templates/users.html","text!apps/user_manager/templates/user_details.html","views/partials/dialog","common","models/subtypes","apps/user_manager/scripts/models/users"],function(e){var t=e("jquery"),n=e("backbone"),r=e("handlebars"),i=e("local_config"),s=e("text!apps/user_manager/templates/user_list_item.html"),o=e("text!apps/user_manager/templates/users.html"),u=e("text!apps/user_manager/templates/user_details.html"),a=e("views/partials/dialog"),f=e("common"),l=e("models/subtypes"),c=e("apps/user_manager/scripts/models/users"),h=l.SortableTableView.extend({className:"user-manager",initialize:function(){this.baseCollection=c,this.collection=new c,this.childView=p},render:function(){var e=this;return this.$el.html(o),this.delegateEvents(),this.collection.fetch({success:function(t){t.sortByAttribute("created_at",-1);var n=t.models,r=[];for(var i=0,s=n.length,o,u;i<s;i++)o=n[i],u=new p({model:o}),r.push(u.el);return e.$el.find(".table-data").append(r),e},error:function(e,t,n){console.log(n.message)}}),this}}),p=n.View.extend({className:"user-list-item table-row",tagName:"tr",template:r.compile(s),events:{click:"viewUserDetails"},initialize:function(){this.render()},render:function(){var e=this.model.attributes;return e.date_creation=(new Date(e.created_at)).toLocaleString(),this.$el.html(this.template({userData:e})),this},viewUserDetails:function(){var e=new d({model:this.model});e.render()}}),d=n.View.extend({className:"user-details-view",template:r.compile(u),events:{"click .edit":"editUserInfo","click .cancel":"cancelEditing","click .close-view":"closeView","click .save":"saveUserInfo","click .delete":"deleteUser"},render:function(){t(document).scrollTop(0);var e=this.model.attributes;switch(e.type.toLowerCase().split(" ").join("_")){case"user":e.userSelected="selected";break;case"demo_user":e.demouserSelected="selected";break;case"customer":e.customerSelected="selected";break;case"admin":e.adminSelected="selected";break;default:e.userSelected="selected"}return f.userManager.$el.html(this.el),this.$el.html(this.template(e)),this.delegateEvents(),this},cancelEditing:function(){this.$el.removeClass("editing-mode")},closeView:function(){this.close(),f.userManager.render()},deleteUser:function(){var e=this,t=function(){e.model.save(null,{url:i.urlRoot+"/users/"+e.model.attributes.uid,type:"DELETE",success:function(){console.log("user deleted")},error:function(e,t,n){console.log(n.message)}}),e.closeView()};a.confirmationDialog.loadData("Are you sure you want to delete this user?","All data related to this user will be swiped from the database.",t),a.confirmationDialog.render()},editUserInfo:function(){this.$el.addClass("editing-mode")},saveUserInfo:function(){var e=this,n={type:t("#user-types").val(),organization:t("#organization-name").val()};this.model.set(n),this.model.save(null,{url:i.urlRoot+"/users/"+this.model.attributes.uid,success:function(){e.cancelEditing(),e.render()},error:function(e,t,n){console.log(n.message)}})}});return f.userManager=new h,f.userManager}),define("app",["require","index","common","apps/user_manager/scripts/views/user_manager"],function(e){var t=e("index"),n=e("common"),r=e("apps/user_manager/scripts/views/user_manager");n.loadApp(n.userManager.render().el)});